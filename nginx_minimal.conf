# 最小可用的Nginx配置 - 解决所有当前问题
# 用于 adddesigngroup.com
# 路径：/var/www/weatherlikedressing
# 端口：3300

server {
    listen 80;
    server_name adddesigngroup.com www.adddesigngroup.com;

    # ⚠️ 必须在最前面：Let's Encrypt验证路径
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
        try_files $uri =404;
    }

    # 后端 API
    location /api {
        proxy_pass http://localhost:3300;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 健康检查
    location /health {
        proxy_pass http://localhost:3300/health;
    }

    # 静态资源
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        root /var/www/weatherlikedressing/frontend/dist;
        try_files $uri =404;
        expires 1y;
    }

    # 前端应用（最后）
    location / {
        root /var/www/weatherlikedressing/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    error_log /var/log/nginx/weatherlikedressing-error.log;
    access_log /var/log/nginx/weatherlikedressing-access.log;
}
