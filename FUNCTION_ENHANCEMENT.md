# 功能完善清单

根据详细的穿衣推荐规则文档，以下是对现有系统的功能完善建议：

## ✅ 已实现的功能

1. ✅ 基础体感分数计算（ComfortScore）
2. ✅ 温度、湿度、风力、阳光、活动强度计算
3. ✅ 用户画像调整（年龄组、敏感度、健康条件）
4. ✅ 穿衣层级映射
5. ✅ 基础健康规则
6. ✅ 推送触发配置（配置已存在）
7. ✅ 推荐历史记录
8. ✅ 多地点支持

## 🔧 需要完善的功能

### 高优先级（核心功能缺失）

#### 1. **阵风影响计算** ⚠️
- **现状**：有 `gust_m_s` 字段但未在计算中使用
- **需求**：阵风额外扣分
- **实现位置**：`backend/services/ruleEngine.js` 的 `calculateComfortScore` 方法

#### 2. **湿度规则细化** ⚠️
- **现状**：只区分了冷热两种情况的湿度影响
- **需求**：
  - 湿冷（RH ≥ 70% 且 T ≤ 12°C）：额外扣分并提示防潮
  - 高湿热（RH ≥ 70% 且 T ≥ 25°C）：强调透气性
- **实现位置**：规则引擎计算逻辑

#### 3. **降雨规则** ⚠️
- **现状**：有 `precip_prob` 但未用于推荐
- **需求**：降雨概率 > 50% 时提示带雨具、防滑鞋
- **实现位置**：规则引擎和健康规则

#### 4. **用户画像扩展** ⚠️
- **现状**：只有基础年龄组和条件
- **需求**：添加
  - 是否儿童（更细化的年龄段）
  - 是否怀孕
  - 更细化的敏感度设置（-6到-12的可调范围）
- **实现位置**：用户资料JSON结构和规则引擎

#### 5. **个性化规则细化** ⚠️
- **现状**：基础调整已实现
- **需求**：
  - 风湿患者在湿冷时自动提升保暖层级（+2层）
  - 儿童/老人在低温时强制提示帽子/围巾/手套
  - 65+老人在ComfortScore < 0时自动提高一层保暖
- **实现位置**：规则引擎的穿衣推荐映射

### 中优先级（体验优化）

#### 6. **推荐理由详细化** ⭐
- **现状**：只有简单的计算明细
- **需求**：生成类似这样的理由：
  - "体感 -12（低温-2°C + 大风6 m/s + 高湿78%）→ 体感显著降低，建议加羽绒与围巾"
- **实现位置**：规则引擎的 `generateRecommendation` 方法

#### 7. **输出格式完善** ⭐
- **现状**：缺少 `urgency` 和 `confidence` 字段
- **需求**：根据天气条件计算紧急程度和置信度
- **实现位置**：规则引擎输出

#### 8. **紫外线规则细化** ⭐
- **现状**：只判断是否 ≥ 3
- **需求**：按UV等级（0-2低，3-5中，6-7高，8-11+极高）给出不同建议
- **实现位置**：规则引擎和配饰推荐

#### 9. **风力规则细化** ⭐
- **现状**：统一的风力扣分
- **需求**：按风速分级（0-1.5微风，1.5-5有风，5-10中等风，10+强风）给出不同建议
- **实现位置**：规则引擎和推荐层级

#### 10. **温度独立规则** ⭐
- **现状**：只有体感分数映射
- **需求**：按温度段（28°C+，20-28°C，10-20°C，0-10°C，<0°C）给出基础建议
- **实现位置**：可以作为辅助规则，叠加到体感分数上

### 低优先级（增强功能）

#### 11. **室内/暖气/空调判断**
- **现状**：只有简单的 `is_outdoor` 标志
- **需求**：室内时判断是否有暖气/空调，调整推荐
- **实现位置**：用户输入和规则引擎

#### 12. **穿衣历史/偏好**
- **现状**：未实现
- **需求**：记录用户穿衣偏好，用于个性化偏差
- **实现位置**：数据库新表 + 推荐算法调整

#### 13. **推送服务实现**
- **现状**：只有配置，没有实际推送逻辑
- **需求**：实现实际的推送触发和发送
- **实现位置**：新的推送服务模块

#### 14. **可视化解释增强**
- **现状**：基础的展开/收起
- **需求**：更友好的计算过程展示，便于用户理解
- **实现位置**：前端组件

## 实现优先级建议

### 第一阶段（核心完善）
1. 阵风影响计算
2. 降雨规则
3. 推荐理由详细化
4. 输出格式完善（urgency, confidence）

### 第二阶段（规则细化）
5. 湿度规则细化
6. 紫外线规则细化
7. 风力规则细化
8. 个性化规则细化

### 第三阶段（功能扩展）
9. 用户画像扩展
10. 穿衣历史/偏好
11. 推送服务实现
12. 可视化增强

## 具体实现建议

### 1. 完善规则引擎计算逻辑

需要修改 `backend/services/ruleEngine.js`，添加：
- 阵风扣分计算
- 湿度规则细化判断
- 降雨规则
- 更详细的原因生成

### 2. 更新规则配置文件

需要更新 `dressing_rules_v1.json`，添加：
- 阵风权重配置
- 降雨规则配置
- UV分级配置
- 风力分级配置
- 更详细的健康规则

### 3. 扩展用户资料结构

需要更新用户表的 `profile_json` 字段，支持：
- 更细化的年龄组
- 是否怀孕
- 敏感度范围（-6到-12）
- 室内设置（是否有暖气/空调）

### 4. 前端界面增强

需要更新前端组件，展示：
- 更详细的推荐理由
- urgency和confidence显示
- 降雨提示
- UV分级提示

## 下一步行动

1. 先实现高优先级功能（阵风、降雨、理由详细化）
2. 然后完善规则细化（湿度、UV、风力）
3. 最后扩展个性化功能

建议按阶段逐步实现，确保每个阶段的功能完整可用。
